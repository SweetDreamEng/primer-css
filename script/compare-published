#!/bin/bash
set -e

tag=${1:${NPM_TAG}:-latest}
modules=`ls -1 modules | egrep primer-`

# separator
s=,

echo "ðŸ“¦  Comparing Primer modules published @${tag}..."
(
    echo "module${s}tag${s}published${s}local"
    for module in $modules; do
        v_published=`npm info ${module}@${tag} .version`
        v_local=`jq -Mr .version modules/${module}/package.json`
        echo "${module}${s}${tag}${s}${v_published:-x}${s}${v_local}"
    done
) | column -t -s=${s}
