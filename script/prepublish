#!/bin/bash

slug=$(cat package.json | npx fx 'p => `${p.name}@${p.version}`')
npx action-status --context="$PUBLISH_STATUS_CONTEXT" \
    --state=pending \
    --description="publishing $slug..."

# generate the build directory
npm run dist

files=$(git ls-files src | sed -e 's#^src/##' | sed -e 's#/.*$##' | sort -u)
echo $files > publish-files.log
cd src
cp -rv $files ..
cd -
