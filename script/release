#!/bin/bash
set -e
echo "ðŸ“¦  Publishing latest release..."

$(dirname $0)/notify pending

# note: try-publish should exit cleanly if it detects a duplicate
# published version
$(npm bin)/lerna exec -- $(pwd)/script/try-publish

# Build and publish storybook
$(npm bin)/build-storybook -o build
$(npm bin)/gh-pages -d build -b gh-pages -r https://${GH_TOKEN}@github.com/primer/storybook

echo "ðŸ““  Updated CHANGELOG..."

$(npm bin)/lerna-changelog

$(dirname $0)/notify success
